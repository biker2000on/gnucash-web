---
phase: 02-enhanced-transaction-journal
plan: 03
type: execute
wave: 3
depends_on: [02]
files_modified: [src/components/TransactionForm.tsx, src/components/TransactionDetailsModal.tsx]
autonomous: true

must_haves:
  truths:
    - "User can add/remove split rows in the transaction form"
    - "Form shows real-time balance indicator to help users zero-sum"
    - "User can search for accounts within split rows"
  artifacts:
    - path: "src/components/TransactionForm.tsx"
      provides: "Multi-split data entry UI"
    - path: "src/components/AccountSelect.tsx"
      provides: "Searchable account selection"
  key_links:
    - from: "src/components/TransactionForm.tsx"
      to: "/api/transactions"
      via: "POST/PUT fetch calls"
---

<objective>
Build the frontend UI for creating and editing transactions.

Purpose: Provide an intuitive interface for entering complex multi-split transactions while maintaining double-entry constraints.
Output: A dynamic form component and its integration into the transaction details modal.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-enhanced-transaction-journal/02-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create AccountSelect Component</name>
  <files>src/components/AccountSelect.tsx</files>
  <action>
    Create a searchable select component for accounts.
    - Fetches account hierarchy to provide a flat or nested list of options.
    - Supports keyboard navigation.
    - Displays full account path (e.g., "Expenses:Food:Groceries").
  </action>
  <verify>Type "Exp" in the select and confirm "Expenses" accounts are filtered and displayed.</verify>
  <done>Searchable account selector is ready for use in split rows.</done>
</task>

<task type="auto">
  <name>Build TransactionForm Component</name>
  <files>src/components/TransactionForm.tsx</files>
  <action>
    Create a form that manages:
    - Header fields: Date, Num, Description.
    - Dynamic Split list: At least 2 splits by default.
    - "Add Split" button.
    - Each split row: Account selection, Memo, Amount.
    - Live "Difference" indicator (Total of splits, must be 0 to submit).
    
    Use `react-hook-form` or similar for state management if appropriate.
  </action>
  <verify>Enter 100 in one split and -100 in another; confirm the "Difference" shows 0 and "Save" button is enabled.</verify>
  <done>Form handles multi-split entry with real-time balancing feedback.</done>
</task>

<task type="auto">
  <name>Integrate Editor into Details Modal</name>
  <files>src/components/TransactionDetailsModal.tsx, src/components/TransactionJournal.tsx</files>
  <action>
    Update `TransactionDetailsModal` to support "Edit" mode.
    - Add an "Edit" button to the view modal.
    - When clicked, switch view to `TransactionForm` pre-populated with current data.
    - Add a "New Transaction" button to `TransactionJournal` that opens the modal in "Create" mode.
    
    Handle successful submission by closing modal and refreshing the list.
  </action>
  <verify>Click "New Transaction", enter data, save, and confirm it appears in the list. Edit an existing one and confirm changes persist.</verify>
  <done>Users can fully manage transactions through the journal UI.</done>
</task>

</tasks>

<verification>
- Form prevents submission if splits do not sum to zero.
- Account search is fast and accurate.
- "New" and "Edit" flows correctly update the database via API.
</verification>

<success_criteria>
- User can create a 3-split transaction (e.g., Split payment across two accounts).
- Editing a transaction correctly updates all associated splits.
</success_criteria>

<output>
After completion, create `.planning/phases/02-enhanced-transaction-journal/02-03-SUMMARY.md`
</output>
