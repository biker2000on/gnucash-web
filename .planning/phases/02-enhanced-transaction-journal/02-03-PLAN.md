---
phase: 02-enhanced-transaction-journal
plan: 03
type: execute
wave: 3
depends_on: [02]
files_modified: [src/components/TransactionForm.tsx, src/components/TransactionDetailsModal.tsx]
autonomous: true

must_haves:
  truths:
    - "User can add/remove split rows in the transaction form"
    - "Form shows real-time balance indicator to help users zero-sum"
    - "User can search for accounts within split rows"
    - "User can delete a transaction from the journal"
  artifacts:
    - path: "src/components/TransactionForm.tsx"
      provides: "Multi-split data entry UI"
    - path: "src/components/AccountSelect.tsx"
      provides: "Searchable account selection"
    - path: "src/components/TransactionEditModal.tsx"
      provides: "Consolidated CRUD UI"
  key_links:
    - from: "src/components/TransactionForm.tsx"
      to: "/api/transactions"
      via: "POST/PUT fetch calls"
---

<objective>
Build the frontend UI for creating and editing transactions.

Purpose: Provide an intuitive interface for entering complex multi-split transactions while maintaining double-entry constraints.
Output: A dynamic form component and its integration into the transaction editor.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-enhanced-transaction-journal/02-02-SUMMARY.md
@src/components/TransactionForm.tsx
@src/components/SplitRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Create AccountSelect Component</name>
  <files>src/components/AccountSelect.tsx</files>
  <action>
    Create a searchable select component for accounts (if not already handled by AccountSelector).
    - Fetches account hierarchy to provide a flat or nested list of options.
    - Supports keyboard navigation.
    - Displays full account path (e.g., "Expenses:Food:Groceries").
  </action>
  <verify>Type "Exp" in the select and confirm "Expenses" accounts are filtered and displayed.</verify>
  <done>Searchable account selector is ready for use in split rows.</done>
</task>

<task type="auto">
  <name>Update TransactionForm with Action Field</name>
  <files>src/components/TransactionForm.tsx, src/components/SplitRow.tsx, src/lib/types.ts</files>
  <action>
    Update `TransactionForm` and `SplitRow` to include the 'Action' field for each split:
    - Add `action` to `SplitFormData` type in `src/lib/types.ts`.
    - Add an 'Action' input field in `SplitRow.tsx` (e.g., a small text input or common actions dropdown).
    - Ensure `TransactionForm.tsx` correctly handles the state for the `action` field.
    - Ensure `action` is passed to the API in `handleSubmit`.
    
    This matches GnuCash's ability to label splits (e.g., 'Buy', 'Sell', 'Withdrawal').
  </action>
  <verify>Open form, enter 'Buy' in a split action field, save, and verify API payload includes action: 'Buy'.</verify>
  <done>Split rows now support the GnuCash 'Action' field.</done>
</task>

<task type="auto">
  <name>Integrate Editor and Delete Actions</name>
  <files>src/components/TransactionEditModal.tsx, src/components/TransactionJournal.tsx</files>
  <action>
    Update `TransactionEditModal` and `TransactionJournal` to support full lifecycle:
    - Add "New Transaction" button to `TransactionJournal` that opens `TransactionEditModal` in "create" mode.
    - Ensure "Delete" button in `TransactionEditModal` (view mode) correctly triggers the DELETE API and refreshes the journal.
    - Implement/Verify delete confirmation dialog.
    - Ensure successful "Save" or "Delete" refreshes the `TransactionJournal` list.
  </action>
  <verify>Click "New Transaction", enter data, save, and confirm it appears. Open it again, click "Delete", confirm, and verify it is gone from the list.</verify>
  <done>Users can fully manage transactions (Create, Read, Update, Delete) through the journal UI.</done>
</task>

</tasks>

<verification>
- Form prevents submission if splits do not sum to zero.
- Account search is fast and accurate.
- "New" and "Edit" flows correctly update the database via API.
</verification>

<success_criteria>
- User can create a 3-split transaction (e.g., Split payment across two accounts).
- Editing a transaction correctly updates all associated splits.
</success_criteria>

<output>
After completion, create `.planning/phases/02-enhanced-transaction-journal/02-03-SUMMARY.md`
</output>
