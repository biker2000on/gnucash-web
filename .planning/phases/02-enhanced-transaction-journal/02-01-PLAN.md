---
phase: 02-enhanced-transaction-journal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/app/api/transactions/route.ts, src/components/TransactionFilters.tsx, src/components/TransactionJournal.tsx, src/components/TransactionDetailsModal.tsx]
autonomous: true

must_haves:
  truths:
    - "User can filter transactions by date range (start/end)"
    - "User can filter transactions by amount range"
    - "User can filter transactions by reconciliation status (reconciled/cleared/not)"
    - "User can filter transactions by account type (Asset, Liability, etc.)"
    - "User can see all splits for a transaction in a modal"
  artifacts:
    - path: "src/components/TransactionFilters.tsx"
      provides: "Filtering UI for journal"
    - path: "src/components/TransactionEditModal.tsx"
      provides: "Split-level transaction details and editor"
    - path: "src/app/api/transactions/route.ts"
      provides: "Advanced filtering support in GET"
  key_links:
    - from: "src/components/TransactionJournal.tsx"
      to: "/api/transactions"
      via: "query parameters in fetch"
    - from: "src/components/TransactionJournal.tsx"
      to: "src/components/TransactionEditModal.tsx"
      via: "prop-driven visibility"
---

<objective>
Enable advanced filtering and detailed viewing of transactions.

Purpose: Allow users to find specific data and understand the split breakdown of any transaction before enabling editing.
Output: Dynamic filtering UI and an enhanced transaction details/edit modal.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-enhanced-transaction-journal/02-RESEARCH.md
@src/components/TransactionModal.tsx
@src/components/TransactionEditModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Update Transactions API Filtering</name>
  <files>src/app/api/transactions/route.ts</files>
  <action>
    Update GET handler to extract and apply the following filters from URL search params:
    - startDate / endDate (post_date)
    - minAmount / maxAmount (value_num/value_denom)
    - accountType (filter by account_type of any split in transaction)
    - status (reconcile_state: 'n', 'c', 'y')
    - description (search/partial match)
    
    Ensure pagination still works alongside filters.
    Use Prisma where clauses dynamically built from provided params.
    For accountType, ensure it filters transactions that have at least one split belonging to an account of that type.
  </action>
  <verify>Run `curl "http://localhost:3000/api/transactions?startDate=2026-01-01&status=y"` and verify results only include reconciled transactions.</verify>
  <done>API correctly filters transactions based on all provided parameters including type and status.</done>
</task>

<task type="auto">
  <name>Update TransactionFilters Component</name>
  <files>src/components/TransactionFilters.tsx, src/components/TransactionJournal.tsx</files>
  <action>
    Update/Create `TransactionFilters` component with inputs for:
    - Date range (Start/End)
    - Amount range (Min/Max)
    - Reconciliation Status (Select: All, Reconciled, Cleared, Not Reconciled)
    - Account Type (Select: All, Asset, Liability, Income, Expense, etc.)
    - Description search (debounced)
    
    Integrate it into `TransactionJournal` above the transaction list.
    Ensure changing filters triggers a refresh of the transaction list with updated query params.
  </action>
  <verify>Open browser, change status filter, confirm list updates and API call includes `status` param.</verify>
  <done>UI controls exist for all required filters and correctly trigger data fetching.</done>
</task>

<task type="auto">
  <name>Consolidate and Enhance Transaction Modal</name>
  <files>src/components/TransactionEditModal.tsx, src/components/TransactionJournal.tsx</files>
  <action>
    Use/Enhance `TransactionEditModal.tsx` as the primary transaction viewer:
    - Display header (Date, Description, Num)
    - Table of ALL splits (Account Name, Memo, Action, Amount)
    - Ensure 'Action' is displayed for splits (if available in GnuCash split data)
    - Verification that splits sum to zero (Total row)
    
    Wire it so clicking a transaction row in `TransactionJournal` opens this modal in 'view' mode.
    Note: `TransactionEditModal.tsx` replaces the need for separate `TransactionModal.tsx` and `TransactionDetailsModal.tsx`.
  </action>
  <verify>Click a transaction in the journal; modal opens showing correct splits and balancing total. Verify Action column exists.</verify>
  <done>Users can view the full double-entry details of any transaction in a consolidated modal.</done>
</task>

</tasks>

<verification>
- API filtering works for all 5 parameters.
- Filter UI correctly updates the list.
- Modal shows correct split data for selected transaction.
</verification>

<success_criteria>
- Filtered list matches expected count from database.
- Modal displays all splits even if they belong to accounts not currently in view.
</success_criteria>

<output>
After completion, create `.planning/phases/02-enhanced-transaction-journal/02-01-SUMMARY.md`
</output>
