---
phase: 05-reporting-system
plan: 03
type: execute
wave: 3
depends_on: [05-02-PLAN.md]
files_modified: [src/components/reports/ReportCharts.tsx, src/lib/reports/exporters/pdf.ts, src/lib/reports/exporters/excel.ts, src/lib/reports/exporters/csv.ts]
autonomous: true

must_haves:
  truths:
    - "Reports can be visualized with charts"
    - "Reports can be exported to PDF"
    - "Reports can be exported to Excel"
    - "Reports can be exported to CSV"
  artifacts:
    - path: "src/components/reports/ReportCharts.tsx"
      provides: "Chart visualization components"
    - path: "src/lib/reports/exporters/pdf.ts"
      provides: "PDF export functionality"
    - path: "src/lib/reports/exporters/excel.ts"
      provides: "Excel export functionality"
  key_links:
    - from: "src/components/reports/ReportViewer.tsx"
      to: "src/lib/reports/exporters"
      via: "export button handlers"
---

<objective>
Implement chart visualizations and report exports.

Purpose: Allow users to visualize data and export reports for sharing.
Output: Chart components and PDF/Excel/CSV exporters.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/05-reporting-system/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Install Export Dependencies</name>
  <files>package.json</files>
  <action>
    Install @react-pdf/renderer, xlsx, and papaparse for exports.
  </action>
  <verify>npm install succeeds</verify>
  <done>Export libraries installed.</done>
</task>

<task type="auto">
  <name>Create ReportCharts Component</name>
  <files>src/components/reports/ReportCharts.tsx</files>
  <action>
    Create chart components using recharts:
    1. PieChart: Account type breakdown
    2. BarChart: Income vs Expenses by month
    3. LineChart: Balance over time
    4. AreaChart: Cash flow trend

    Each chart:
    - Responsive sizing
    - Tooltips on hover
    - Legend
    - Color-coded by category
    - Optional comparison series

    Export: getChartAsImage() for PDF embedding
  </action>
  <verify>Charts render with sample data</verify>
  <done>Chart components available.</done>
</task>

<task type="auto">
  <name>Create PDF Exporter</name>
  <files>src/lib/reports/exporters/pdf.ts</files>
  <action>
    Create PDF generator using @react-pdf/renderer:
    - Define styles (fonts, colors, spacing)
    - Create page template with header/footer
    - Generate Balance Sheet PDF
    - Generate Income Statement PDF
    - Generate Cash Flow PDF
    - Include charts as images
    - Add page numbers
    - Add generation timestamp

    Export function: generatePDF(reportType, data, filters) => Blob
  </action>
  <verify>PDF generates and downloads correctly</verify>
  <done>PDF export functional.</done>
</task>

<task type="auto">
  <name>Create Excel Exporter</name>
  <files>src/lib/reports/exporters/excel.ts</files>
  <action>
    Create Excel generator using xlsx:
    - Create workbook with multiple sheets
    - Format numbers as currency
    - Add header row with filters info
    - Style headers (bold, background)
    - Auto-fit column widths
    - Add formulas for totals

    Export function: generateExcel(reportType, data, filters) => Blob
  </action>
  <verify>Excel file opens correctly in spreadsheet app</verify>
  <done>Excel export functional.</done>
</task>

<task type="auto">
  <name>Create CSV Exporter</name>
  <files>src/lib/reports/exporters/csv.ts</files>
  <action>
    Create CSV generator using papaparse:
    - Simple tabular format
    - Include headers
    - Proper escaping for special characters
    - UTF-8 encoding with BOM for Excel compatibility

    Export function: generateCSV(reportType, data, filters) => string
  </action>
  <verify>CSV imports correctly into spreadsheet</verify>
  <done>CSV export functional.</done>
</task>

<task type="auto">
  <name>Integrate Exports into ReportViewer</name>
  <files>src/components/reports/ReportViewer.tsx</files>
  <action>
    Add export functionality:
    1. Export dropdown button with PDF/Excel/CSV options
    2. Loading state during export generation
    3. Download file with appropriate name and extension
    4. Error handling for export failures
  </action>
  <verify>All export formats download correctly</verify>
  <done>Report exports integrated into viewer.</done>
</task>

</tasks>

<verification>
- Charts display correctly in all reports
- PDF export maintains formatting
- Excel export includes formulas
- CSV export is properly formatted
</verification>

<success_criteria>
Reports can be visualized and exported in multiple formats.
</success_criteria>

<output>
After completion, create `.planning/phases/05-reporting-system/05-03-SUMMARY.md`
</output>
