---
phase: 04-budgeting-system
plan: 01
type: execute
wave: 1
depends_on: [03-03-PLAN.md]
files_modified: [src/app/(main)/budgets/page.tsx, src/app/api/budgets/route.ts, src/app/api/budgets/[guid]/route.ts, src/components/BudgetList.tsx, src/components/BudgetForm.tsx]
autonomous: true

must_haves:
  truths:
    - "User can view list of all budgets"
    - "User can create new budgets with name and period count"
    - "User can edit budget name and description"
    - "User can delete budgets"
  artifacts:
    - path: "src/app/(main)/budgets/page.tsx"
      provides: "Budget list page"
    - path: "src/components/BudgetList.tsx"
      provides: "Budget listing component"
    - path: "src/components/BudgetForm.tsx"
      provides: "Budget create/edit form"
  key_links:
    - from: "src/app/(main)/budgets/page.tsx"
      to: "/api/budgets"
      via: "fetch"
---

<objective>
Create budget list and management interface.

Purpose: Allow users to view, create, edit, and delete budgets.
Output: Budget list page with CRUD functionality.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/04-budgeting-system/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Add Budget Model to Prisma Schema</name>
  <files>prisma/schema.prisma</files>
  <action>
    Add Budget and BudgetAmount models if not already present from introspection:

    model Budget {
      guid        String   @id @db.Char(32)
      name        String
      description String?
      num_periods Int      @map("num_periods")
      amounts     BudgetAmount[]
      @@map("budgets")
    }

    model BudgetAmount {
      id           Int    @id @default(autoincrement())
      budget_guid  String @db.Char(32)
      account_guid String @db.Char(32)
      period_num   Int    @map("period_num")
      amount_num   BigInt @map("amount_num")
      amount_denom BigInt @map("amount_denom")
      budget       Budget @relation(fields: [budget_guid], references: [guid])
      @@map("budget_amounts")
      @@unique([budget_guid, account_guid, period_num])
    }

    Run prisma generate after changes.
  </action>
  <verify>npx prisma generate succeeds</verify>
  <done>Budget models available in Prisma client.</done>
</task>

<task type="auto">
  <name>Create Budget API Endpoints</name>
  <files>src/app/api/budgets/route.ts, src/app/api/budgets/[guid]/route.ts</files>
  <action>
    /api/budgets:
    - GET: List all budgets with period count
    - POST: Create new budget with guid, name, num_periods

    /api/budgets/[guid]:
    - GET: Get budget details with amounts
    - PUT: Update name, description
    - DELETE: Delete budget and cascade amounts
  </action>
  <verify>CRUD operations work via curl</verify>
  <done>Budget API endpoints functional.</done>
</task>

<task type="auto">
  <name>Create BudgetList Component</name>
  <files>src/components/BudgetList.tsx</files>
  <action>
    Create component showing:
    - Table/grid of budgets
    - Columns: Name, Periods, Description (truncated)
    - Click row to navigate to editor
    - Actions: Edit, Delete buttons
    - Empty state with "Create First Budget" CTA
  </action>
  <verify>Component renders budget list correctly</verify>
  <done>BudgetList displays all budgets.</done>
</task>

<task type="auto">
  <name>Create BudgetForm Component</name>
  <files>src/components/BudgetForm.tsx</files>
  <action>
    Form with fields:
    - Name (required)
    - Description (optional)
    - Number of periods (1-60, default 12)
    - Period type selector (Monthly, Quarterly, Yearly)
    - Start date picker

    Support create and edit modes.
    Validate required fields.
  </action>
  <verify>Form creates and edits budgets correctly</verify>
  <done>BudgetForm handles budget metadata.</done>
</task>

<task type="auto">
  <name>Create Budgets Page</name>
  <files>src/app/(main)/budgets/page.tsx</files>
  <action>
    1. Create page that fetches and displays BudgetList
    2. Add "New Budget" button in header
    3. Open BudgetForm in modal for create/edit
    4. Add navigation link in sidebar
  </action>
  <verify>Page loads, shows budgets, can create new</verify>
  <done>Budget management page complete.</done>
</task>

</tasks>

<verification>
- Can view list of budgets
- Can create new budget
- Can edit existing budget
- Can delete budget
</verification>

<success_criteria>
Budget list and CRUD operations fully functional.
</success_criteria>

<output>
After completion, create `.planning/phases/04-budgeting-system/04-01-SUMMARY.md`
</output>
